// Emoji Picker Module
// Usage: EmojiPicker.show({ anchor: buttonElement, input: inputElement });

const EmojiPicker = (() => {
  const emojiCategories = [
    {
      title: 'Activities',
      emojis: ['⚽','🏀','🏈','⚾','🥎','🎾','🏐','🏉','🥏','🎱','🪀','🏓','🏸','🥅','🏒','🏑','🏏','🪃','🥍','🏹','🎣','🤿','🥊','🥋','🎽','🛹','🛷','⛸️','🥌','🛼','🪁','🎿','⛷️','🏂','🏋️‍♂️','🏋️‍♀️','🤼‍♂️','🤼‍♀️','🤸‍♂️','🤸‍♀️','⛹️‍♂️','⛹️‍♀️','🤺','🤾‍♂️','🤾‍♀️','🏌️‍♂️','🏌️‍♀️','🏇','🧘‍♂️','🧘‍♀️','🏄‍♂️','🏄‍♀️','🏊‍♂️','🏊‍♀️','🤽‍♂️','🤽‍♀️','🚣‍♂️','🚣‍♀️','🧗‍♂️','🧗‍♀️','🚵‍♂️','🚵‍♀️','🚴‍♂️','🚴‍♀️','🏆','🥇','🥈','🥉','🏅','🎖️','🏵️','🎗️','🎫','🎟️','🎪','🤹‍♂️','🤹‍♀️','🎭','🩰','🎨','🎬','🎤','🎧','🎼','🎹','🥁','🪘','🎷','🎺','🪗','🎸','🪕','🎻','🎲','♟️','🎯','🪄','🎮','🕹️','🎰','🎲','🧩','🪆','♠️','♥️','♦️','♣️','🃏','🀄','🎴','🔮','🧿','🪬','🎆','🎇','🎈','🎉','🎊','🎋','🎍','🎎','🎏','🎐','🎑','🧧','🎀','🎁','🪅','🪩','🪆']
    },
    {
      title: 'Travel & Places',
      emojis: ['🚗','🚕','🚙','🚌','🚎','🏎️','🚓','🚑','🚒','🚐','🛻','🚚','🚛','🚜','🏍️','🛵','🦽','🦼','🛺','🚲','🛴','🛹','🛼','🚨','🚔','🚍','🚘','🚖','🚡','🚠','🚟','🚃','🚋','🚞','🚝','🚄','🚅','🚈','🚂','🚆','🚇','🚊','🚉','🚁','🛩️','✈️','🛫','🛬','🪂','💺','🚀','🛸','🛶','⛵','🚤','🛥️','🛳️','⛴️','🚢','⚓','🪝','⛽','🚧','🚦','🚥','🚏','🗺️','🗿','🗽','🗼','🏰','🏯','🏟️','🎡','🎢','🎠','⛲','⛱️','🏖️','🏝️','🏜️','🌋','⛰️','🏔️','🗻','🏕️','🏠','🏡','🏘️','🏚️','🏗️','🏭','🏢','🏬','🏣','🏤','🏥','🏦','🏨','🏩','🏪','🏫','🏛️','⛪','🕌','🕍','🛕','🕋','⛩️','🛤️','🛣️','🗾','🎑','🏞️','🌅','🌄','🌠','🎇','🎆','🌇','🌆','🏙️','🌃','🌌','🌉','🌁']
    },
    {
      title: 'Objects',
      emojis: ['⌚','📱','📲','💻','⌨️','🖥️','🖨️','🖱️','🖲️','🕹️','🗜️','💽','💾','💿','📀','📼','📷','📸','📹','🎥','📽️','🎞️','📞','☎️','📟','📠','📺','📻','🎙️','🎚️','🎛️','⏱️','⏲️','⏰','🕰️','⌛','⏳','📡','🔋','🔌','💡','🔦','🕯️','🪔','🧯','🛢️','💸','💵','💴','💶','💷','🪙','💰','💳','🧾','💎','⚖️','🪜','🧰','🧲','🧪','🧫','🧬','🦠','🧹','🧺','🧻','🪣','🧼','🪥','🧽','🧴','🛁','🛀','🛎️','🔑','🗝️','🚪','🪞','🪟','🛏️','🛋️','🪑','🚽','🚿','🧯','🛒','🚬','⚰️','🪦','⚱️','🗿','🪧','🏺','🧭','🧱','🧲','🧰','🧯','🧪','🧫','🧬','🦠','🧹','🧺','🧻','🪣','🧼','🪥','🧽','🧴','🛁','🛀','🛎️','🔑','🗝️','🚪','🪞','🪟','🛏️','🛋️','🪑','🚽','🚿','🧯','🛒','🚬','⚰️','🪦','⚱️','🗿','🪧','🏺']
    },
    {
      title: 'Symbols',
      emojis: ['❤️','💛','💚','💙','💜','🖤','🤍','🤎','💔','❣️','💕','💞','💓','💗','💖','💘','💝','💟','☮️','✝️','☪️','🕉️','☸️','✡️','🔯','🕎','☯️','☦️','🛐','⛎','♈','♉','♊','♋','♌','♍','♎','♏','♐','♑','♒','♓','🆔','⚛️','🉑','☢️','☣️','📴','📳','🈶','🈚','🈸','🈺','🈷️','🈯','🉐','🈹','🈲','🅰️','🅱️','🆎','🆑','🅾️','🆘','⛔','🚫','📛','🚷','🚯','🚳','🚱','🔞','📵','🚭','❌','⭕','🛑','⛔','💯','💢','💥','💦','💨','🕳️','💣','💬','👁️‍🗨️','🗨️','🗯️','💭','💤','💮','♨️','💈','🛎️','🧳','✈️','🛩️','🛫','🛬','🛳️','⛴️','🚢','⚓','⛽','🚧','🚦','🚥','🚏','🗺️','🗿','🗽','🗼','🏰','🏯','🏟️','🎡','🎢','🎠','⛲','⛱️','🏖️','🏝️','🏜️','🌋','⛰️','🏔️','🗻','🏕️','🏠','🏡','🏘️','🏚️','🏗️','🏭','🏢','🏬','🏣','🏤','🏥','🏦','🏨','🏩','🏪','🏫','🏛️','⛪','🕌','🕍','🛕','🕋','⛩️','🛤️','🛣️','🗾','🎑','🏞️','🌅','🌄','🌠','🎇','🎆','🌇','🌆','🏙️','🌃','🌌','🌉','🌁']
    }
  ];

  let popup = null;

  function show({ anchor, input }) {
    if (popup) popup.remove();
    popup = document.createElement('div');
    popup.className = 'emoji-picker-popup';
    let html = '';
    emojiCategories.forEach(cat => {
      html += `<div class='emoji-section-title'>${cat.title}</div>`;
      html += `<div class='emoji-grid'>`;
      html += cat.emojis.map(e => `<button type='button' class='emoji-btn'>${e}</button>`).join('');
      html += '</div>';
    });
    popup.innerHTML = html;
    document.body.appendChild(popup);
    popup.style.display = 'block';
    const rect = anchor.getBoundingClientRect();
    popup.style.left = rect.left + window.scrollX + 'px';
    popup.style.top = rect.bottom + window.scrollY + 'px';

    popup.onclick = (ev) => {
      if (ev.target.classList.contains('emoji-btn')) {
        const emoji = ev.target.textContent;
        const start = input.selectionStart;
        const end = input.selectionEnd;
        const val = input.value;
        input.value = val.slice(0, start) + emoji + val.slice(end);
        input.focus();
        input.selectionStart = input.selectionEnd = start + emoji.length;
        popup.remove();
        popup = null;
      }
    };
    document.addEventListener('click', function hide(ev) {
      if (!popup.contains(ev.target) && ev.target !== anchor) {
        if (popup) popup.remove();
        popup = null;
      }
    }, { capture: true, once: true });
  }

  return { show };
})();

window.EmojiPicker = EmojiPicker;
