// Emoji Picker Module
// Usage: EmojiPicker.show({ anchor: buttonElement, input: inputElement });

const EmojiPicker = (() => {
  const emojiCategories = [
    {
      title: 'Activities',
      emojis: ['âš½','ðŸ€','ðŸˆ','âš¾','ðŸ¥Ž','ðŸŽ¾','ðŸ','ðŸ‰','ðŸ¥','ðŸŽ±','ðŸª€','ðŸ“','ðŸ¸','ðŸ¥…','ðŸ’','ðŸ‘','ðŸ','ðŸªƒ','ðŸ¥','ðŸ¹','ðŸŽ£','ðŸ¤¿','ðŸ¥Š','ðŸ¥‹','ðŸŽ½','ðŸ›¹','ðŸ›·','â›¸ï¸','ðŸ¥Œ','ðŸ›¼','ðŸª','ðŸŽ¿','â›·ï¸','ðŸ‚','ðŸ‹ï¸â€â™‚ï¸','ðŸ‹ï¸â€â™€ï¸','ðŸ¤¼â€â™‚ï¸','ðŸ¤¼â€â™€ï¸','ðŸ¤¸â€â™‚ï¸','ðŸ¤¸â€â™€ï¸','â›¹ï¸â€â™‚ï¸','â›¹ï¸â€â™€ï¸','ðŸ¤º','ðŸ¤¾â€â™‚ï¸','ðŸ¤¾â€â™€ï¸','ðŸŒï¸â€â™‚ï¸','ðŸŒï¸â€â™€ï¸','ðŸ‡','ðŸ§˜â€â™‚ï¸','ðŸ§˜â€â™€ï¸','ðŸ„â€â™‚ï¸','ðŸ„â€â™€ï¸','ðŸŠâ€â™‚ï¸','ðŸŠâ€â™€ï¸','ðŸ¤½â€â™‚ï¸','ðŸ¤½â€â™€ï¸','ðŸš£â€â™‚ï¸','ðŸš£â€â™€ï¸','ðŸ§—â€â™‚ï¸','ðŸ§—â€â™€ï¸','ðŸšµâ€â™‚ï¸','ðŸšµâ€â™€ï¸','ðŸš´â€â™‚ï¸','ðŸš´â€â™€ï¸','ðŸ†','ðŸ¥‡','ðŸ¥ˆ','ðŸ¥‰','ðŸ…','ðŸŽ–ï¸','ðŸµï¸','ðŸŽ—ï¸','ðŸŽ«','ðŸŽŸï¸','ðŸŽª','ðŸ¤¹â€â™‚ï¸','ðŸ¤¹â€â™€ï¸','ðŸŽ­','ðŸ©°','ðŸŽ¨','ðŸŽ¬','ðŸŽ¤','ðŸŽ§','ðŸŽ¼','ðŸŽ¹','ðŸ¥','ðŸª˜','ðŸŽ·','ðŸŽº','ðŸª—','ðŸŽ¸','ðŸª•','ðŸŽ»','ðŸŽ²','â™Ÿï¸','ðŸŽ¯','ðŸª„','ðŸŽ®','ðŸ•¹ï¸','ðŸŽ°','ðŸŽ²','ðŸ§©','ðŸª†','â™ ï¸','â™¥ï¸','â™¦ï¸','â™£ï¸','ðŸƒ','ðŸ€„','ðŸŽ´','ðŸ”®','ðŸ§¿','ðŸª¬','ðŸŽ†','ðŸŽ‡','ðŸŽˆ','ðŸŽ‰','ðŸŽŠ','ðŸŽ‹','ðŸŽ','ðŸŽŽ','ðŸŽ','ðŸŽ','ðŸŽ‘','ðŸ§§','ðŸŽ€','ðŸŽ','ðŸª…','ðŸª©','ðŸª†']
    },
    {
      title: 'Travel & Places',
      emojis: ['ðŸš—','ðŸš•','ðŸš™','ðŸšŒ','ðŸšŽ','ðŸŽï¸','ðŸš“','ðŸš‘','ðŸš’','ðŸš','ðŸ›»','ðŸšš','ðŸš›','ðŸšœ','ðŸï¸','ðŸ›µ','ðŸ¦½','ðŸ¦¼','ðŸ›º','ðŸš²','ðŸ›´','ðŸ›¹','ðŸ›¼','ðŸš¨','ðŸš”','ðŸš','ðŸš˜','ðŸš–','ðŸš¡','ðŸš ','ðŸšŸ','ðŸšƒ','ðŸš‹','ðŸšž','ðŸš','ðŸš„','ðŸš…','ðŸšˆ','ðŸš‚','ðŸš†','ðŸš‡','ðŸšŠ','ðŸš‰','ðŸš','ðŸ›©ï¸','âœˆï¸','ðŸ›«','ðŸ›¬','ðŸª‚','ðŸ’º','ðŸš€','ðŸ›¸','ðŸ›¶','â›µ','ðŸš¤','ðŸ›¥ï¸','ðŸ›³ï¸','â›´ï¸','ðŸš¢','âš“','ðŸª','â›½','ðŸš§','ðŸš¦','ðŸš¥','ðŸš','ðŸ—ºï¸','ðŸ—¿','ðŸ—½','ðŸ—¼','ðŸ°','ðŸ¯','ðŸŸï¸','ðŸŽ¡','ðŸŽ¢','ðŸŽ ','â›²','â›±ï¸','ðŸ–ï¸','ðŸï¸','ðŸœï¸','ðŸŒ‹','â›°ï¸','ðŸ”ï¸','ðŸ—»','ðŸ•ï¸','ðŸ ','ðŸ¡','ðŸ˜ï¸','ðŸšï¸','ðŸ—ï¸','ðŸ­','ðŸ¢','ðŸ¬','ðŸ£','ðŸ¤','ðŸ¥','ðŸ¦','ðŸ¨','ðŸ©','ðŸª','ðŸ«','ðŸ›ï¸','â›ª','ðŸ•Œ','ðŸ•','ðŸ›•','ðŸ•‹','â›©ï¸','ðŸ›¤ï¸','ðŸ›£ï¸','ðŸ—¾','ðŸŽ‘','ðŸžï¸','ðŸŒ…','ðŸŒ„','ðŸŒ ','ðŸŽ‡','ðŸŽ†','ðŸŒ‡','ðŸŒ†','ðŸ™ï¸','ðŸŒƒ','ðŸŒŒ','ðŸŒ‰','ðŸŒ']
    },
    {
      title: 'Objects',
      emojis: ['âŒš','ðŸ“±','ðŸ“²','ðŸ’»','âŒ¨ï¸','ðŸ–¥ï¸','ðŸ–¨ï¸','ðŸ–±ï¸','ðŸ–²ï¸','ðŸ•¹ï¸','ðŸ—œï¸','ðŸ’½','ðŸ’¾','ðŸ’¿','ðŸ“€','ðŸ“¼','ðŸ“·','ðŸ“¸','ðŸ“¹','ðŸŽ¥','ðŸ“½ï¸','ðŸŽžï¸','ðŸ“ž','â˜Žï¸','ðŸ“Ÿ','ðŸ“ ','ðŸ“º','ðŸ“»','ðŸŽ™ï¸','ðŸŽšï¸','ðŸŽ›ï¸','â±ï¸','â²ï¸','â°','ðŸ•°ï¸','âŒ›','â³','ðŸ“¡','ðŸ”‹','ðŸ”Œ','ðŸ’¡','ðŸ”¦','ðŸ•¯ï¸','ðŸª”','ðŸ§¯','ðŸ›¢ï¸','ðŸ’¸','ðŸ’µ','ðŸ’´','ðŸ’¶','ðŸ’·','ðŸª™','ðŸ’°','ðŸ’³','ðŸ§¾','ðŸ’Ž','âš–ï¸','ðŸªœ','ðŸ§°','ðŸ§²','ðŸ§ª','ðŸ§«','ðŸ§¬','ðŸ¦ ','ðŸ§¹','ðŸ§º','ðŸ§»','ðŸª£','ðŸ§¼','ðŸª¥','ðŸ§½','ðŸ§´','ðŸ›','ðŸ›€','ðŸ›Žï¸','ðŸ”‘','ðŸ—ï¸','ðŸšª','ðŸªž','ðŸªŸ','ðŸ›ï¸','ðŸ›‹ï¸','ðŸª‘','ðŸš½','ðŸš¿','ðŸ§¯','ðŸ›’','ðŸš¬','âš°ï¸','ðŸª¦','âš±ï¸','ðŸ—¿','ðŸª§','ðŸº','ðŸ§­','ðŸ§±','ðŸ§²','ðŸ§°','ðŸ§¯','ðŸ§ª','ðŸ§«','ðŸ§¬','ðŸ¦ ','ðŸ§¹','ðŸ§º','ðŸ§»','ðŸª£','ðŸ§¼','ðŸª¥','ðŸ§½','ðŸ§´','ðŸ›','ðŸ›€','ðŸ›Žï¸','ðŸ”‘','ðŸ—ï¸','ðŸšª','ðŸªž','ðŸªŸ','ðŸ›ï¸','ðŸ›‹ï¸','ðŸª‘','ðŸš½','ðŸš¿','ðŸ§¯','ðŸ›’','ðŸš¬','âš°ï¸','ðŸª¦','âš±ï¸','ðŸ—¿','ðŸª§','ðŸº']
    },
    {
      title: 'Symbols',
      emojis: ['â¤ï¸','ðŸ’›','ðŸ’š','ðŸ’™','ðŸ’œ','ðŸ–¤','ðŸ¤','ðŸ¤Ž','ðŸ’”','â£ï¸','ðŸ’•','ðŸ’ž','ðŸ’“','ðŸ’—','ðŸ’–','ðŸ’˜','ðŸ’','ðŸ’Ÿ','â˜®ï¸','âœï¸','â˜ªï¸','ðŸ•‰ï¸','â˜¸ï¸','âœ¡ï¸','ðŸ”¯','ðŸ•Ž','â˜¯ï¸','â˜¦ï¸','ðŸ›','â›Ž','â™ˆ','â™‰','â™Š','â™‹','â™Œ','â™','â™Ž','â™','â™','â™‘','â™’','â™“','ðŸ†”','âš›ï¸','ðŸ‰‘','â˜¢ï¸','â˜£ï¸','ðŸ“´','ðŸ“³','ðŸˆ¶','ðŸˆš','ðŸˆ¸','ðŸˆº','ðŸˆ·ï¸','ðŸˆ¯','ðŸ‰','ðŸˆ¹','ðŸˆ²','ðŸ…°ï¸','ðŸ…±ï¸','ðŸ†Ž','ðŸ†‘','ðŸ…¾ï¸','ðŸ†˜','â›”','ðŸš«','ðŸ“›','ðŸš·','ðŸš¯','ðŸš³','ðŸš±','ðŸ”ž','ðŸ“µ','ðŸš­','âŒ','â­•','ðŸ›‘','â›”','ðŸ’¯','ðŸ’¢','ðŸ’¥','ðŸ’¦','ðŸ’¨','ðŸ•³ï¸','ðŸ’£','ðŸ’¬','ðŸ‘ï¸â€ðŸ—¨ï¸','ðŸ—¨ï¸','ðŸ—¯ï¸','ðŸ’­','ðŸ’¤','ðŸ’®','â™¨ï¸','ðŸ’ˆ','ðŸ›Žï¸','ðŸ§³','âœˆï¸','ðŸ›©ï¸','ðŸ›«','ðŸ›¬','ðŸ›³ï¸','â›´ï¸','ðŸš¢','âš“','â›½','ðŸš§','ðŸš¦','ðŸš¥','ðŸš','ðŸ—ºï¸','ðŸ—¿','ðŸ—½','ðŸ—¼','ðŸ°','ðŸ¯','ðŸŸï¸','ðŸŽ¡','ðŸŽ¢','ðŸŽ ','â›²','â›±ï¸','ðŸ–ï¸','ðŸï¸','ðŸœï¸','ðŸŒ‹','â›°ï¸','ðŸ”ï¸','ðŸ—»','ðŸ•ï¸','ðŸ ','ðŸ¡','ðŸ˜ï¸','ðŸšï¸','ðŸ—ï¸','ðŸ­','ðŸ¢','ðŸ¬','ðŸ£','ðŸ¤','ðŸ¥','ðŸ¦','ðŸ¨','ðŸ©','ðŸª','ðŸ«','ðŸ›ï¸','â›ª','ðŸ•Œ','ðŸ•','ðŸ›•','ðŸ•‹','â›©ï¸','ðŸ›¤ï¸','ðŸ›£ï¸','ðŸ—¾','ðŸŽ‘','ðŸžï¸','ðŸŒ…','ðŸŒ„','ðŸŒ ','ðŸŽ‡','ðŸŽ†','ðŸŒ‡','ðŸŒ†','ðŸ™ï¸','ðŸŒƒ','ðŸŒŒ','ðŸŒ‰','ðŸŒ']
    }
  ];

  let popup = null;

  function show({ anchor, input }) {
    if (popup) popup.remove();
    popup = document.createElement('div');
    popup.className = 'emoji-picker-popup';
    let html = '';
    emojiCategories.forEach(cat => {
      html += `<div class='emoji-section-title'>${cat.title}</div>`;
      html += `<div class='emoji-grid'>`;
      html += cat.emojis.map(e => `<button type='button' class='emoji-btn'>${e}</button>`).join('');
      html += '</div>';
    });
    popup.innerHTML = html;
    document.body.appendChild(popup);
    popup.style.display = 'block';
    const rect = anchor.getBoundingClientRect();
    popup.style.left = rect.left + window.scrollX + 'px';
    popup.style.top = rect.bottom + window.scrollY + 'px';

    popup.onclick = (ev) => {
      if (ev.target.classList.contains('emoji-btn')) {
        const emoji = ev.target.textContent;
        const start = input.selectionStart;
        const end = input.selectionEnd;
        const val = input.value;
        input.value = val.slice(0, start) + emoji + val.slice(end);
        input.focus();
        input.selectionStart = input.selectionEnd = start + emoji.length;
        popup.remove();
        popup = null;
      }
    };
    document.addEventListener('click', function hide(ev) {
      if (!popup.contains(ev.target) && ev.target !== anchor) {
        if (popup) popup.remove();
        popup = null;
      }
    }, { capture: true, once: true });
  }

  return { show };
})();

window.EmojiPicker = EmojiPicker;
